<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    :root {
      --gradient: linear-gradient(90deg, #00ff94 0%, #00cfff 100%);
      --btn-gradient: linear-gradient(90deg, #00ff94 0%, #00cfff 100%);
      --btn-gradient-hover: linear-gradient(90deg, #00cfff 0%, #00ff94 100%);
      --border-radius: 18px;
      --navbar-height: 70px;
      --text-main: #fff;
      --text-secondary: #bfc9d9;
      --bg-dark: #18191c;
      --card-bg: #23242a;
    }
    html, body {
      background: var(--bg-dark);
      color: var(--text-main);
      font-family: 'Source Sans Pro', Arial, sans-serif;
      min-height: 100vh;
      width: 100vw;
      margin: 0;
      padding: 0;
    }
    .admin-container {
        max-width: 1300px;
        width: 98vw;
        margin: 30px auto 0 auto;
        padding: 32px 24px 24px 24px;
        background: var(--card-bg);
        border-radius: var(--border-radius);
        overflow-x: auto;
    }
    .section-title, h1, h2, h3, h4, h5 {
      font-family: 'Poppins', Arial, sans-serif;
      font-weight: 700;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.8em;
    }
    .nav-tabs {
      border-bottom: 1px solid #333;
    }
    .nav-link {
      color: #bfc9d9 !important;
      font-weight: 600;
      background: none !important;
      border: none !important;
      border-radius: var(--border-radius) var(--border-radius) 0 0;
      margin-right: 5px;
      padding: 12px 20px;
      transition: 0.18s, color 0.18s;
    }
    .nav-link.active, .nav-link:focus, .nav-link:hover {
      background: var(--btn-gradient) !important;
      color: #18191c !important;
      font-weight: 700;
    }
    .card, .subject-card, .chapter-card, .quiz-card, .question-card, .stats-card {
      background: #23242a;
      border-radius: var(--border-radius);
      color: var(--text-main);
      margin-bottom: 18px;
      border: none;
    }
    .user-management-card {
      background: #23242a;
      border-radius: var(--border-radius);
      color: var(--text-main);
      margin-bottom: 18px;
      border: none;
      padding: 20px;
    }
    .subject-card, .chapter-card, .quiz-card, .question-card {
      padding: 18px 22px;
      margin-bottom: 18px;
      transition: transform 0.18s, box-shadow 0.18s;
      cursor: pointer;
    }
    .subject-card:hover, .chapter-card:hover, .quiz-card:hover, .question-card:hover {
      background: #272b33;
      transform: translateY(-3px) scale(1.015);
      box-shadow: 0 4px 32px 0 rgba(0,255,148,0.13);
    }
    .action-btns {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn, .btn-warning, .btn-success, .btn-info, .btn-primary, .btn-secondary, .btn-danger {
      background: var(--btn-gradient);
      color: #18191c !important;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 700;
      transition: 0.18s, transform 0.14s, box-shadow 0.18s;
      padding: 8px 20px;
      margin-bottom: 4px;
    }
    .btn:hover, .btn:focus, .btn-warning:hover, .btn-warning:focus,
    .btn-success:hover, .btn-success:focus, .btn-info:hover, .btn-info:focus,
    .btn-primary:hover, .btn-primary:focus, .btn-secondary:hover, .btn-secondary:focus {
      background: var(--btn-gradient-hover);
      color: #18191c !important;
      transform: translateY(-2px) scale(1.04);
    }
    .btn-danger {
      background: linear-gradient(90deg, #ff5e62 0%, #ff914d 100%) !important;
      color: #fff !important;
    }
    .btn-danger:hover, .btn-danger:focus {
      background: linear-gradient(90deg, #ff914d 0%, #ff5e62 100%) !important;
      color: #fff !important;
    }
    .form-control, textarea, input, select {
      background: #23242a !important;
      color: #fff !important;
      border-radius: 8px !important;
      border: 1px solid #333 !important;
    }
    .form-control:focus {
      background: #23242a !important;
      color: #fff !important;
      border: 1.5px solid #00ff94 !important;
      box-shadow: 0 0 0 2px #00ff9480 !important;
    }
    .description, .card-text {
      font-size: 1rem;
      color: #bfc9d9;
      opacity: 0.88;
      margin-top: 5px;
    }
    .user-table {
        width: 100%;
        table-layout: fixed;
        border-collapse: collapse;
        margin-top: 15px;
        color: #fff;
        background: transparent;
    }
    .user-table th, .user-table td {
        padding: 14px 12px;
        text-align: center;
        border-bottom: 1px solid #333;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        max-width: 1px;
        vertical-align: middle;
    }
    .user-table th {
        background: #23242a;
        color: #00ff94;
        font-weight: 700;
    }
    .user-table tr {
      transition: 0.14s;
    }
    .user-table tr:hover td {
      background: #232b2a;
    }
    .modal-content {
      background: #23242a;
      color: #fff;
      border-radius: var(--border-radius);
    }
    .modal-header {
      border-bottom: 1px solid #333;
    }
    .modal-title {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'Poppins', Arial, sans-serif;
      font-weight: 700;
      font-size: 1.5rem;
    }
    .btn-close {
      filter: invert(1);
    }
    .alert-info, .alert-danger {
      background: #23242a !important;
      color: #00cfff !important;
      border: none !important;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
    }
    .dashboard-card {
        background: #2a2b33;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
    }
    #usersChart {
        max-height: 400px;
    }
    .table-dark th, .table-dark td {
        border-color: #333;
        font-size: 1.08rem;
    }
    .table-dark th {
        color: #00ff94;
        background-color: #232b2a;
        border-bottom: 2px solid #00ff94;
    }
    .table-dark td {
        background-color: #232b2a;
    }
    .badge.bg-info {
        background-color: #00ff94 !important;
        color: #18191c !important;
    }
    .content-card {
        border: 2px solid #00ff94;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
        background: #232b2a;
    }
    @media (max-width: 900px) {
      .admin-container { padding: 2px; }
      .subject-card, .chapter-card, .quiz-card, .question-card { padding: 14px 10px; }
      .user-table th, .user-table td { padding: 10px 6px; font-size: 0.95rem; }
    }
    @media (max-width: 600px) {
      .admin-container { padding: 5px; }
      .subject-card, .chapter-card, .quiz-card, .question-card { padding: 8px 4px; }
      .nav-link { padding: 10px 8px; }
      .user-table th, .user-table td { font-size: 0.85rem; }
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="section-title"><i class="fas fa-user-shield me-2"></i>Admin Dashboard</h2>
                <div>
                    <a href="/logout" class="btn btn-danger"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
                </div>
            </div>
            <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                            data-bs-target="#dashboard-content" type="button" role="tab"
                            aria-controls="dashboard-content" aria-selected="true">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="subjects-tab" data-bs-toggle="tab"
                            data-bs-target="#subjects-content" type="button" role="tab"
                            aria-controls="subjects-content" aria-selected="true">
                        <i class="fas fa-book me-2"></i>Course Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="users-tab" data-bs-toggle="tab"
                            data-bs-target="#users-content" type="button" role="tab"
                            aria-controls="users-content" aria-selected="false">
                        <i class="fas fa-users me-2"></i>User Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="messages-tab" data-bs-toggle="tab"
                            data-bs-target="#messages-content" type="button" role="tab"
                            aria-controls="messages-content" aria-selected="false">
                        <i class="fas fa-envelope me-2"></i>Contact Messages
                    </button>
                </li>
            </ul>
            <div class="tab-content" id="adminTabsContent">
                <div class="tab-pane fade show active" id="dashboard-content" role="tabpanel" aria-labelledby="dashboard-tab">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-users me-2"></i>User Registrations</h4>
                        <canvas id="usersChart"></canvas>
                    </div>
                    <div class="dashboard-card">
                        <h4 class="mb-4" style="color: #00ff94;">
                            <i class="fas fa-book me-2"></i>Courses &amp; Quizzes
                        </h4>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped align-middle mb-0" id="courses-table">
                                <thead>
                                    <tr>
                                        <th style="width:70%;">Courses</th>
                                        <th style="width:30%;">Total Quizzes</th>
                                    </tr>
                                </thead>
                                <tbody id="courses-list">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="subjects-content" role="tabpanel"
                     aria-labelledby="subjects-tab">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h4 class="card-title"><i class="fas fa-book me-2"></i>Courses Management</h4>
                            <button class="btn btn-success mt-2" data-bs-toggle="modal" data-bs-target="#addSubjectModal">
                                <i class="fas fa-plus me-2"></i>Add New Course
                            </button>
                        </div>
                    </div>
                    <div id="subjects-container"></div>
                </div>
                <div class="tab-pane fade" id="users-content" role="tabpanel"
                     aria-labelledby="users-tab">
                    <div class="user-management-card">
                        <div class="stats-card">
                            <h4><i class="fas fa-chart-line me-2"></i>User Statistics</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1">Total Registered Users: <strong id="total-users">0</strong></p>
                                </div>
                            </div>
                        </div>
                        <h4 class="mb-4"><i class="fas fa-user-friends me-2"></i>Registered Users</h4>
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>#</th>  
                                    <th>Username</th>
                                    <th>Registration Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-list">
                            </tbody>
                        </table> 
                    </div>
                </div>
                <div class="tab-pane fade" id="messages-content" role="tabpanel" aria-labelledby="messages-tab">
                    <div class="dashboard-card">
                        <h4><i class="fas fa-envelope me-2"></i>Contact Messages</h4>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Message</th>
                                        <th>Sent At</th>
                                    </tr>
                                </thead>
                                <tbody id="messages-list">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addSubjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus-circle me-2"></i>Add New Course</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-subject-form">
                        <div class="mb-3">
                            <label for="subject-name" class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="subject-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="subject-description" class="form-label">Description</label>
                            <textarea class="form-control" id="subject-description" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editSubjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Course</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-subject-form">
                        <input type="hidden" id="edit-subject-id">
                        <div class="mb-3">
                            <label for="edit-subject-name" class="form-label">Course Name</label>
                            <input type="text" class="form-control" id="edit-subject-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-subject-description" class="form-label">Description</label>
                            <textarea class="form-control" id="edit-subject-description" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addChapterModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-book-open me-2"></i>Add New Concept</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-chapter-form">
                        <input type="hidden" id="chapter-subject-id">
                        <div class="mb-3">
                            <label for="chapter-name" class="form-label">Concept Name</label>
                            <input type="text" class="form-control" id="chapter-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="chapter-description" class="form-label">Description</label>
                            <textarea class="form-control" id="chapter-description" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editChapterModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Concept</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-chapter-form">
                        <input type="hidden" id="edit-chapter-id">
                        <div class="mb-3">
                            <label for="edit-chapter-name" class="form-label">Concept Name</label>
                            <input type="text" class="form-control" id="edit-chapter-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-chapter-description" class="form-label">Description</label>
                            <textarea class="form-control" id="edit-chapter-description" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addQuizModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-clipboard-list me-2"></i>Add New Quiz</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-quiz-form">
                        <input type="hidden" id="quiz-chapter-id">
                        <div class="mb-3">
                            <label for="quiz-date" class="form-label">Quiz Date</label>
                            <input type="date" class="form-control" id="quiz-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="quiz-duration" class="form-label">Time Duration (minutes)</label>
                            <input type="number" class="form-control" id="quiz-duration" required>
                        </div>
                        <div class="mb-3">
                            <label for="quiz-remarks" class="form-label">Remarks</label>
                            <textarea class="form-control" id="quiz-remarks" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editQuizModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Quiz</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-quiz-form">
                        <input type="hidden" id="edit-quiz-id">
                        <div class="mb-3">
                            <label for="edit-quiz-date" class="form-label">Quiz Date</label>
                            <input type="date" class="form-control" id="edit-quiz-date" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-quiz-duration" class="form-label">Time Duration (minutes)</label>
                            <input type="number" class="form-control" id="edit-quiz-duration" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit-quiz-remarks" class="form-label">Remarks</label>
                            <textarea class="form-control" id="edit-quiz-remarks" rows="3"></textarea>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-question-circle me-2"></i>Add New Question</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-question-form">
                        <input type="hidden" id="question-quiz-id">
                        <div class="mb-3">
                            <label for="question-text" class="form-label">Question Text</label>
                            <textarea class="form-control" id="question-text" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Multiple Choice Options</label>
                            <div id="mcq-options-container">
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="correct-option" value="0" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option A" name="option1" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="correct-option" value="1" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option B" name="option2" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="correct-option" value="2" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option C" name="option3" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="correct-option" value="3" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option D" name="option4" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Edit Question</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-question-form">
                        <input type="hidden" id="edit-question-id">
                        <div class="mb-3">
                            <label for="edit-question-text" class="form-label">Question Text</label>
                            <textarea class="form-control" id="edit-question-text" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Multiple Choice Options</label>
                            <div id="edit-mcq-options-container">
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="edit-correct-option" value="0" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option A" id="edit-option1" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="edit-correct-option" value="1" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option B" id="edit-option2" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="edit-correct-option" value="2" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option C" id="edit-option3" required>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input mt-0" type="radio" name="edit-correct-option" value="3" required>
                                        </div>
                                        <input type="text" class="form-control" placeholder="Option D" id="edit-option4" required>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let usersChart = null;
        let currentSubjectId = null;
        let currentChapterId = null;
        let currentQuizId = null;

        document.addEventListener('DOMContentLoaded', function() {
            var usersTab = document.getElementById('users-tab');
            usersTab.addEventListener('shown.bs.tab', loadUsers);
            loadDashboard();
            loadSubjects();

            document.getElementById('dashboard-tab').addEventListener('shown.bs.tab', loadDashboard);
            document.getElementById('add-subject-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addSubject();
            });
            document.getElementById('edit-subject-form').addEventListener('submit', function(e) {
                e.preventDefault();
                editSubject();
            }); 
            document.getElementById('add-chapter-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addChapter();
            }); 
            document.getElementById('edit-chapter-form').addEventListener('submit', function(e) {
                e.preventDefault();
                editChapter();
            });
            document.getElementById('add-quiz-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addQuiz();
            });
            document.getElementById('edit-quiz-form').addEventListener('submit', function(e) {
                e.preventDefault();
                editQuiz();
            });   
            document.getElementById('add-question-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addQuestion();
            });
            document.getElementById('edit-question-form').addEventListener('submit', function(e) {
                e.preventDefault();
                editQuestion();
            });
            document.getElementById('messages-tab').addEventListener('shown.bs.tab', loadMessages);
            
        });

        function loadMessages() {
            fetch('/admin/contact_messages')
                .then(response => response.json())
                .then(data => {
                    const messagesList = document.getElementById('messages-list');
                    messagesList.innerHTML = '';
                    if (data.length === 0) {
                        messagesList.innerHTML = `<tr><td colspan="5" class="text-center text-muted">No messages found.</td></tr>`;
                    } else {
                        data.forEach((msg, idx) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${idx + 1}</td>
                                <td>${msg.name}</td>
                                <td>${msg.email}</td>
                                <td>${msg.message}</td>
                                <td>${new Date(msg.sent_at).toLocaleString()}</td>
                            `;
                            messagesList.appendChild(row);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error loading messages:', error);
                    document.getElementById('messages-list').innerHTML = 
                        `<tr><td colspan="5" class="text-center text-danger">Error loading messages</td></tr>`;
                });
        }

        async function loadDashboard() {
            try {
                const userStats = await fetch('/admin/user_stats').then(r => r.json());
                renderUserChart(userStats);
                const courseStats = await fetch('/admin/courses_with_quiz_count').then(r => r.json());
                renderCourseStats(courseStats);
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }

        function renderUserChart(data) {
            const ctx = document.getElementById('usersChart').getContext('2d');
            if (usersChart) usersChart.destroy();
            usersChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Registered Users',
                        data: data.values,
                        borderColor: '#00ff94',
                        backgroundColor: 'rgba(0, 255, 148, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#fff' }
                        },
                        x: {
                            ticks: { color: '#fff' }
                        }
                    }
                }
            });
        }

        function renderCourseStats(courses) {
            const container = document.getElementById('courses-list');
            if (!courses.length) {
                container.innerHTML = `<tr><td colspan="2" class="text-center text-muted">No courses found.</td></tr>`;
                return;
            }
            container.innerHTML = courses.map(course => `
                <tr>
                    <td>${course.name}</td>
                    <td>
                        <span class="badge bg-info fs-6">${course.quiz_count}</span>
                    </td>
                </tr>
            `).join('');
        }

        function loadUsers() {
            fetch('/admin/users')
                .then(response => response.json())
                .then(data => {
                    const usersList = document.getElementById('users-list');
                    const totalUsers = document.getElementById('total-users');
                    totalUsers.textContent = data.users.length;
                    usersList.innerHTML = '';
                    if (data.users.length === 0) {
                        usersList.innerHTML = `<tr><td colspan="4" class="text-center text-muted">No users found.</td></tr>`;
                    } else {
                        data.users.forEach((user, index) => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${index + 1}</td>
                                <td>${user.username}</td>
                                <td>${user.created_at === 'N/A' ? 'N/A' : new Date(user.created_at).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" 
                                            onclick="deleteUser(${user.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            `;
                            usersList.appendChild(row);
                        });
                    } 
                })
                .catch(error => {
                    console.error('Error loading users:', error);
                    usersList.innerHTML = `<tr><td colspan="4" class="text-center text-danger">Error loading user data</td></tr>`;
                });
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                fetch(`/admin/delete_user/${userId}`, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadUsers(); 
                        alert('User deleted successfully');
                    } else {
                        alert('Error deleting user: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error deleting user:', error);
                    alert('Error deleting user');
                });
            }
        }

        function loadSubjects() {
            fetch('/admin/subjects')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('subjects-container');
                    container.innerHTML = '';
                    if (data.length === 0) {
                        container.innerHTML = '<div class="alert alert-info">No subjects found. Add your first subject!</div>';
                        return;
                    }
                    data.forEach(subject => {
                        const subjectCard = document.createElement('div');
                        subjectCard.className = 'content-card';
                        subjectCard.innerHTML = `
                            <h4>${subject.name}</h4>
                            <p class="description">${subject.description || 'No description provided'}</p>
                        `;
                        subjectCard.addEventListener('click', function() {
                            viewSubject(subject.id, subject.name, subject.description);
                        });
                        container.appendChild(subjectCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading subjects:', error);
                    document.getElementById('subjects-container').innerHTML = 
                        '<div class="alert alert-danger">Error loading subjects. Please try again later.</div>';
                });
        }

        function viewSubject(subjectId, name, description) {
            currentSubjectId = subjectId;
            const container = document.getElementById('subjects-container');
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-secondary mb-3';
            backBtn.innerHTML = '<i class="fas fa-arrow-left me-2"></i>Back to Subjects';
            backBtn.addEventListener('click', function() {
                loadSubjects();
            });
            const subjectDetails = document.createElement('div');
            subjectDetails.className = 'card bg-dark text-white mb-4';
            subjectDetails.innerHTML = `
                <div class="card-body">
                    <h3>${name}</h3>
                    <p>${description || 'No description provided'}</p>
                    <div class="action-btns">
                        <button class="btn btn-info" onclick="prepareAddChapter(${subjectId})">
                            <i class="fas fa-plus me-1"></i>Add Chapter
                        </button>
                        <button class="btn btn-warning" onclick="prepareEditSubject(${subjectId}, '${name.replace(/'/g, "\\'")}', '${(description || '').replace(/'/g, "\\'")}')">
                            <i class="fas fa-edit me-1"></i>Edit
                        </button>
                        <button class="btn btn-danger" onclick="prepareDeleteSubject(${subjectId})">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                    </div>
                </div>
            `;
            const chaptersContainer = document.createElement('div');
            chaptersContainer.id = 'chapter-list';
            chaptersContainer.className = 'mt-4';
            container.innerHTML = '';
            container.appendChild(backBtn);
            container.appendChild(subjectDetails);
            container.appendChild(chaptersContainer);
            loadChaptersForSubject(subjectId);
        }

        function loadChaptersForSubject(subjectId) {
            fetch(`/admin/chapters/${subjectId}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('chapter-list');
                    container.innerHTML = '<h4 class="mb-3">Chapters</h4>';
                    if (data.length === 0) {
                        container.innerHTML += '<div class="alert alert-info">No chapters found for this subject.</div>';
                        return;
                    }
                    data.forEach(chapter => {
                        const chapterCard = document.createElement('div');
                        chapterCard.className = 'content-card';
                        chapterCard.innerHTML = `
                            <div class="d-flex justify-content-between align-items-top">
                                <div>
                                    <h5>${chapter.name}</h5>
                                    <p class="description">${chapter.description || 'No description provided'}</p>
                                </div>
                                <div class="action-btns">
                                    <button class="btn btn-sm btn-info" onclick="prepareAddQuiz(${chapter.id})">
                                        <i class="fas fa-plus"></i> Add Quiz
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="prepareEditChapter(${chapter.id}, '${chapter.name.replace(/'/g, "\\'")}', '${(chapter.description || '').replace(/'/g, "\\'")}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="prepareDeleteChapter(${chapter.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="viewChapter(${chapter.id}, '${chapter.name.replace(/'/g, "\\'")}')">
                                        <i class="fas fa-eye"></i> View Quizzes
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(chapterCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading chapters:', error);
                    document.getElementById('chapter-list').innerHTML = 
                        '<div class="alert alert-danger">Error loading chapters. Please try again later.</div>';
                });
        }

        function viewChapter(chapterId, chapterName) {
            currentChapterId = chapterId;
            const container = document.getElementById('chapter-list');
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-secondary mb-3';
            backBtn.innerHTML = '<i class="fas fa-arrow-left me-2"></i>Back to Chapters';
            backBtn.addEventListener('click', function() {
                loadChaptersForSubject(currentSubjectId);
            });
            const quizzesContainer = document.createElement('div');
            quizzesContainer.className = 'mt-4';
            quizzesContainer.innerHTML = `
                <h4>${chapterName} - Quizzes</h4>
                <button class="btn btn-info mb-3" onclick="prepareAddQuiz(${chapterId})">
                    <i class="fas fa-plus me-1"></i>Add Quiz
                </button>
                <div id="quizzes-list"></div>
            `;
            container.innerHTML = '';
            container.appendChild(backBtn);
            container.appendChild(quizzesContainer);
            loadQuizzesForChapter(chapterId);
        }

        function loadQuizzesForChapter(chapterId) {
            fetch(`/admin/quizzes/${chapterId}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('quizzes-list');
                    container.innerHTML = '';
                    if (data.length === 0) {
                        container.innerHTML = '<div class="alert alert-info">No quizzes found for this chapter.</div>';
                        return;
                    }
                    data.forEach(quiz => {
                        const quizDate = new Date(quiz.date_of_quiz).toLocaleDateString();
                        const quizCard = document.createElement('div');
                        quizCard.className = 'content-card';
                        quizCard.innerHTML = `
                            <div class="d-flex justify-content-between align-items-top">
                                <div>
                                    <p>${quiz.remarks || 'No remarks'}</p>
                                    <p class="description">Duration: ${quiz.time_duration} mins</p>
                                </div>
                                <div class="action-btns">
                                    <button class="btn btn-sm btn-info" onclick="prepareAddQuestion(${quiz.id})">
                                        <i class="fas fa-plus"></i> Add Question
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="prepareEditQuiz(${quiz.id}, '${quiz.date_of_quiz}', ${quiz.time_duration}, '${(quiz.remarks || '').replace(/'/g, "\\'")}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="prepareDeleteQuiz(${quiz.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="viewQuiz(${quiz.id}, '${quizDate}')">
                                        <i class="fas fa-eye"></i> View Questions
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(quizCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading quizzes:', error);
                    document.getElementById('quizzes-list').innerHTML = 
                        '<div class="alert alert-danger">Error loading quizzes. Please try again later.</div>';
                });
        }

        function viewQuiz(quizId, quizDate) {
            currentQuizId = quizId;
            const container = document.getElementById('quizzes-list');
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-secondary mb-3';
            backBtn.innerHTML = '<i class="fas fa-arrow-left me-2"></i>Back to Quizzes';
            backBtn.addEventListener('click', function() {
                loadQuizzesForChapter(currentChapterId);
            });
            const questionsContainer = document.createElement('div');
            questionsContainer.className = 'mt-4';
            questionsContainer.innerHTML = `
                <h4>Questions</h4>
                <button class="btn btn-info mb-3" onclick="prepareAddQuestion(${quizId})">
                    <i class="fas fa-plus me-1"></i>Add Question
                </button>
                <div id="questions-list"></div>
            `;
            container.innerHTML = '';
            container.appendChild(backBtn);
            container.appendChild(questionsContainer);
            loadQuestionsForQuiz(quizId);
        }

        function loadQuestionsForQuiz(quizId) {
            fetch(`/admin/questions/${quizId}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('questions-list');
                    container.innerHTML = '';
                    if (data.length === 0) {
                        container.innerHTML = '<div class="alert alert-info">No questions found for this quiz.</div>';
                        return;
                    }
                    data.forEach(question => {
                        const questionCard = document.createElement('div');
                        questionCard.className = 'question-card';
                        questionCard.innerHTML = `
                            <div class="d-flex justify-content-between align-items-top">
                                <div>
                                    <h5>${question.question_statement}</h5>
                                    <div class="options mt-2">
                                        <p class="${question.correct_option === 0 ? 'text-success fw-bold' : ''}">A: ${question.option1}</p>
                                        <p class="${question.correct_option === 1 ? 'text-success fw-bold' : ''}">B: ${question.option2}</p>
                                        <p class="${question.correct_option === 2 ? 'text-success fw-bold' : ''}">C: ${question.option3}</p>
                                        <p class="${question.correct_option === 3 ? 'text-success fw-bold' : ''}">D: ${question.option4}</p>
                                    </div>
                                    <p class="text-warning">Correct Answer: ${['A', 'B', 'C', 'D'][question.correct_option]}</p>
                                </div>
                                <div class="action-btns">
                                    <button class="btn btn-sm btn-warning" onclick="prepareEditQuestion(${question.id}, '${question.question_statement.replace(/'/g, "\\'")}', '${question.option1.replace(/'/g, "\\'")}', '${question.option2.replace(/'/g, "\\'")}', '${question.option3.replace(/'/g, "\\'")}', '${question.option4.replace(/'/g, "\\'")}', ${question.correct_option})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="prepareDeleteQuestion(${question.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(questionCard);
                    });
                })
                .catch(error => {
                    console.error('Error loading questions:', error);
                    document.getElementById('questions-list').innerHTML = 
                        '<div class="alert alert-danger">Error loading questions. Please try again later.</div>';
                });
        }

        function addSubject() {
            const name = document.getElementById('subject-name').value;
            const description = document.getElementById('subject-description').value;
            fetch('/admin/add_subject', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, description })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('subject-name').value = '';
                document.getElementById('subject-description').value = '';
                bootstrap.Modal.getInstance(document.getElementById('addSubjectModal')).hide();
                loadSubjects();
            })
            .catch(error => {
                console.error('Error adding subject:', error);
                alert('Error adding subject. Please try again.');
            });
        }
        
        function prepareEditSubject(subjectId, name, description) {
            document.getElementById('edit-subject-id').value = subjectId;
            document.getElementById('edit-subject-name').value = name;
            document.getElementById('edit-subject-description').value = description;
            new bootstrap.Modal(document.getElementById('editSubjectModal')).show();
        }
        
        function editSubject() {
            const subjectId = document.getElementById('edit-subject-id').value;
            const name = document.getElementById('edit-subject-name').value;
            const description = document.getElementById('edit-subject-description').value;  
            fetch(`/admin/edit_subject/${subjectId}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, description })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || 'Subject updated successfully');
                bootstrap.Modal.getInstance(document.getElementById('editSubjectModal')).hide();
                if (currentSubjectId === parseInt(subjectId)) {
                    viewSubject(subjectId, name, description);
                } else {
                    loadSubjects();
                }
            })
            .catch(error => {
                console.error('Error editing subject:', error);
                alert('Error editing subject. Please try again.');
            });
        }
        
        function prepareDeleteSubject(subjectId) {
            if (confirm('Are you sure you want to delete this subject? This will also delete associated chapters and quizzes.')) {
                fetch(`/admin/delete_subject/${subjectId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Subject deleted successfully');
                    loadSubjects();
                })
                .catch(error => {
                    console.error('Error deleting subject:', error);
                    alert('Error deleting subject. Please try again.');
                });
            }
        }

        function prepareAddChapter(subjectId) {
            document.getElementById('chapter-subject-id').value = subjectId;
            new bootstrap.Modal(document.getElementById('addChapterModal')).show();
        }
        
        function addChapter() {
            const subjectId = document.getElementById('chapter-subject-id').value;
            const name = document.getElementById('chapter-name').value;
            const description = document.getElementById('chapter-description').value;
            fetch('/admin/add_chapter', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ subject_id: subjectId, name, description })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('chapter-name').value = '';
                document.getElementById('chapter-description').value = '';
                bootstrap.Modal.getInstance(document.getElementById('addChapterModal')).hide();
                loadChaptersForSubject(subjectId);
            })
            .catch(error => {
                console.error('Error adding chapter:', error);
                alert('Error adding chapter. Please try again.');
            });
        }
        
        function prepareEditChapter(chapterId, name, description) {
            document.getElementById('edit-chapter-id').value = chapterId;
            document.getElementById('edit-chapter-name').value = name;
            document.getElementById('edit-chapter-description').value = description;
            new bootstrap.Modal(document.getElementById('editChapterModal')).show();
        }
        
        function editChapter() {
            const chapterId = document.getElementById('edit-chapter-id').value;
            const name = document.getElementById('edit-chapter-name').value;
            const description = document.getElementById('edit-chapter-description').value;
            fetch(`/admin/edit_chapter/${chapterId}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, description })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || 'Chapter updated successfully');
                bootstrap.Modal.getInstance(document.getElementById('editChapterModal')).hide();
                loadChaptersForSubject(currentSubjectId);
            })
            .catch(error => {
                console.error('Error editing chapter:', error);
                alert('Error editing chapter. Please try again.');
            });
        }
        
        function prepareDeleteChapter(chapterId) {
            if (confirm('Are you sure you want to delete this chapter? This will also delete associated quizzes.')) {
                fetch(`/admin/delete_chapter/${chapterId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Chapter deleted successfully');
                    loadChaptersForSubject(currentSubjectId);
                })
                .catch(error => {
                    console.error('Error deleting chapter:', error);
                    alert('Error deleting chapter. Please try again.');
                });
            }
        }

        function prepareAddQuiz(chapterId) {
            document.getElementById('quiz-chapter-id').value = chapterId;
            new bootstrap.Modal(document.getElementById('addQuizModal')).show();
        }
        
        function addQuiz() {
            const chapterId = document.getElementById('quiz-chapter-id').value;
            const date = document.getElementById('quiz-date').value;
            const duration = document.getElementById('quiz-duration').value;
            const remarks = document.getElementById('quiz-remarks').value;
            fetch('/admin/add_quiz', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ chapter_id: chapterId, date_of_quiz: date, time_duration: duration, remarks })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('quiz-date').value = '';
                document.getElementById('quiz-duration').value = '';
                document.getElementById('quiz-remarks').value = '';
                bootstrap.Modal.getInstance(document.getElementById('addQuizModal')).hide();
                
                const quizzesList = document.getElementById('quizzes-list');
                if (quizzesList) {
                    loadQuizzesForChapter(chapterId);
                } else {
                    loadChaptersForSubject(currentSubjectId);
                }
            })
            .catch(error => {
                console.error('Error adding quiz:', error);
                alert('Error adding quiz. Please try again.');
            });
        }
        
        function prepareEditQuiz(quizId, dateOfQuiz, timeDuration, remarks) {
            const formattedDate = dateOfQuiz.split('T')[0]; 
            document.getElementById('edit-quiz-id').value = quizId;
            document.getElementById('edit-quiz-date').value = formattedDate;
            document.getElementById('edit-quiz-duration').value = timeDuration;
            document.getElementById('edit-quiz-remarks').value = remarks;
            new bootstrap.Modal(document.getElementById('editQuizModal')).show();
        }
        
        function editQuiz() {
            const quizId = document.getElementById('edit-quiz-id').value;
            const dateOfQuiz = document.getElementById('edit-quiz-date').value;
            const timeDuration = document.getElementById('edit-quiz-duration').value;
            const remarks = document.getElementById('edit-quiz-remarks').value;
            fetch(`/admin/edit_quiz/${quizId}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ date_of_quiz: dateOfQuiz, time_duration: timeDuration, remarks })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || 'Quiz updated successfully');
                bootstrap.Modal.getInstance(document.getElementById('editQuizModal')).hide();
                
                loadQuizzesForChapter(currentChapterId);
            })
            .catch(error => {
                console.error('Error editing quiz:', error);
                alert('Error editing quiz. Please try again.');
            });
        }
        
        function prepareDeleteQuiz(quizId) {
            if (confirm('Are you sure you want to delete this quiz?')) {
                fetch(`/admin/delete_quiz/${quizId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Quiz deleted successfully');
                    loadQuizzesForChapter(currentChapterId);
                })
                .catch(error => {
                    console.error('Error deleting quiz:', error);
                    alert('Error deleting quiz. Please try again.');
                });
            }
        }

        function prepareAddQuestion(quizId) {
            document.getElementById('question-quiz-id').value = quizId;
            new bootstrap.Modal(document.getElementById('addQuestionModal')).show();
        }
        
        function addQuestion() {
            const quizId = document.getElementById('question-quiz-id').value;
            const questionText = document.getElementById('question-text').value;
            const options = document.querySelectorAll('#mcq-options-container input[type="text"]');
            const correctOptionRadios = document.querySelectorAll('input[name="correct-option"]');
            const correctOptionIndex = Array.from(correctOptionRadios).findIndex(radio => radio.checked); 
            if (correctOptionIndex === -1) {
                alert('Please select a correct option');
                return;
            }
            fetch('/admin/add_question', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    quiz_id: quizId,
                    question_statement: questionText,
                    option1: options[0].value,
                    option2: options[1].value,
                    option3: options[2].value,
                    option4: options[3].value,
                    correct_option: correctOptionIndex
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('question-text').value = '';
                options.forEach(option => option.value = '');
                correctOptionRadios.forEach(radio => radio.checked = false);
                
                bootstrap.Modal.getInstance(document.getElementById('addQuestionModal')).hide();
                loadQuestionsForQuiz(quizId);
            })
            .catch(error => {
                console.error('Error adding question:', error);
                alert('Error adding question. Please try again.');
            });
        }
        
        function prepareEditQuestion(questionId, questionText, option1, option2, option3, option4, correctOption) {
            document.getElementById('edit-question-id').value = questionId;
            document.getElementById('edit-question-text').value = questionText;
            document.getElementById('edit-option1').value = option1;
            document.getElementById('edit-option2').value = option2;
            document.getElementById('edit-option3').value = option3;
            document.getElementById('edit-option4').value = option4;
            const radioButtons = document.querySelectorAll('input[name="edit-correct-option"]');
            radioButtons[correctOption].checked = true;
            new bootstrap.Modal(document.getElementById('editQuestionModal')).show();
        }
        
        function editQuestion() {
            const questionId = document.getElementById('edit-question-id').value;
            const questionText = document.getElementById('edit-question-text').value;
            const option1 = document.getElementById('edit-option1').value;
            const option2 = document.getElementById('edit-option2').value;
            const option3 = document.getElementById('edit-option3').value;
            const option4 = document.getElementById('edit-option4').value;
            const correctOptionRadios = document.querySelectorAll('input[name="edit-correct-option"]');
            const correctOption = Array.from(correctOptionRadios).findIndex(radio => radio.checked);   
            if (correctOption === -1) {
                alert('Please select a correct option');
                return;
            }
            fetch(`/admin/edit_question/${questionId}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    question_statement: questionText,
                    option1: option1,
                    option2: option2,
                    option3: option3,
                    option4: option4,
                    correct_option: correctOption
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message || 'Question updated successfully');
                bootstrap.Modal.getInstance(document.getElementById('editQuestionModal')).hide();
                loadQuestionsForQuiz(currentQuizId);
            })
            .catch(error => {
                console.error('Error editing question:', error);
                alert('Error editing question. Please try again.');
            });
        }
        
        function prepareDeleteQuestion(questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                fetch(`/admin/delete_question/${questionId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || 'Question deleted successfully');
                    loadQuestionsForQuiz(currentQuizId);
                })
                .catch(error => {
                    console.error('Error deleting question:', error);
                    alert('Error deleting question. Please try again.');
                });
            }
        }    
    </script>
</body>
</html>